<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TYMODORO - Focus Timer</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='45' fill='%23000' stroke='%23fff' stroke-width='3'/><circle cx='50' cy='50' r='20' fill='%23fff'/></svg>" type="image/svg+xml">
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
</head>
<body data-theme="dark">
    <div class="app">
        <!-- Header -->
        <div class="header">
            <div class="logo-container">
                <div class="logo">TYMODORO</div>
                <div class="logo-dot"></div>
            </div>
            <div class="header-controls">
                <button class="icon-btn" onclick="toggleTodoList()" title="Toggle todo list" id="todoToggleBtn">
                    <i data-lucide="list-todo"></i>
                </button>
                <button class="icon-btn" onclick="toggleCalendar()" title="Calendar" id="calendarBtn">
                    <i data-lucide="calendar"></i>
                </button>
                <button class="icon-btn" onclick="toggleWhiteNoise()" title="Toggle ambient sounds" id="whiteNoiseBtn">
                    <i data-lucide="waves"></i>
                </button>
                <button class="icon-btn" onclick="showThemeSelector()" title="Change theme" id="themeBtn">
                    <i data-lucide="palette"></i>
                </button>
                <button class="icon-btn" onclick="showStats()" title="Statistics">
                    <i data-lucide="bar-chart-3"></i>
                </button>
                <button class="icon-btn" onclick="showSettings()" title="Settings">
                    <i data-lucide="settings"></i>
                </button>
                <button class="icon-btn" onclick="showAbout()" title="About">
                    <i data-lucide="info"></i>
                </button>
                <button class="icon-btn" onclick="openFloatingWindow()" title="Open in Window" id="floatingWindowBtn">
                    <i data-lucide="external-link"></i>
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content timer-only" id="mainContent">
            <!-- Calendar Section -->
            <div class="calendar-section hidden" id="calendarSection">
                <div class="calendar-header">
                    <h2 class="calendar-title">
                        <i data-lucide="calendar"></i>
                        Productivity Calendar
                    </h2>
                    <div class="calendar-nav">
                        <button class="calendar-nav-btn" onclick="prevMonth()">
                            <i data-lucide="chevron-left"></i>
                        </button>
                        <span id="currentMonthYear"></span>
                        <button class="calendar-nav-btn" onclick="nextMonth()">
                            <i data-lucide="chevron-right"></i>
                        </button>
                    </div>
                </div>
                <div class="calendar-grid" id="calendarGrid"></div>
                <div class="calendar-legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--border);"></div>
                        <span>No sessions</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--accent);"></div>
                        <span>1-2 sessions</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--accent); opacity: 0.7;"></div>
                        <span>3-4 sessions</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--success);"></div>
                        <span>5+ sessions</span>
                    </div>
                </div>
            </div>

            <!-- Todo List Section -->
            <div class="todo-section hidden" id="todoSection">
                <div class="todo-header">
                    <h2 class="todo-title">
                        <i data-lucide="check-square"></i>
                        Today's Focus
                    </h2>
                    <div class="todo-stats">
                        <span id="todoProgress">0/0 completed</span>
                    </div>
                </div>
                
                <div class="todo-input-container">
                    <input 
                        type="text" 
                        id="todoInput" 
                        placeholder="Add a new task..."
                        maxlength="100"
                    >
                    <select id="todoPriority" class="priority-select">
                        <option value="low">Low</option>
                        <option value="medium" selected>Medium</option>
                        <option value="high">High</option>
                    </select>
                    <button class="add-todo-btn" onclick="addTodo()" id="addTodoBtn">
                        <i data-lucide="plus"></i>
                    </button>
                </div>
                
                <div class="todo-list" id="todoList">
                    <!-- Todos will be dynamically inserted here -->
                </div>
                
                <div class="todo-footer">
                    <button class="clear-completed-btn" onclick="clearCompleted()" id="clearCompletedBtn">
                        <i data-lucide="trash-2"></i>
                        Clear Completed
                    </button>
                </div>
            </div>

            <!-- Timer Section -->
            <div class="timer-section">
                <div class="session-label" id="sessionLabel">Deep Focus Session</div>
                
                <div class="timer-container">
                    <svg class="progress-ring" viewBox="0 0 100 100">
                        <circle class="progress-ring-bg" cx="50" cy="50" r="45"/>
                        <circle class="progress-ring-fill" cx="50" cy="50" r="45" 
                                stroke-dasharray="283" stroke-dashoffset="283" id="progressCircle"/>
                    </svg>
                    
                    <div class="timer-display">
                        <div class="timer-time" id="timerDisplay">25:00</div>
                        <div class="timer-status" id="timerStatus">Ready to Start</div>
                    </div>
                </div>

                <button class="play-btn" id="playBtn" onclick="toggleTimer()">
                    <i data-lucide="play" id="playIcon"></i>
                </button>

                <div class="control-buttons">
                    <button class="ctrl-btn" onclick="resetTimer()">
                        <i data-lucide="rotate-ccw"></i>
                        Reset
                    </button>
                    <button class="ctrl-btn" onclick="skipSession()">
                        <i data-lucide="skip-forward"></i>
                        Skip
                    </button>
                </div>
            </div>
        </div>

        <!-- Notification Sound Indicator -->
        <div class="sound-indicator" id="soundIndicator" onclick="toggleSound()" title="Toggle notification sound">
            <i data-lucide="bell"></i>
        </div>

        <!-- White Noise Controls -->
        <div class="white-noise-controls" id="whiteNoiseControls" style="display: none;">
            <div class="noise-header">
                <h3>Ambient Sounds</h3>
                <div class="noise-tabs">
                    <button class="noise-tab active" onclick="switchNoiseTab('regular')" id="regularTab">Regular</button>
                    <button class="noise-tab" onclick="switchNoiseTab('binaural')" id="binauralTab">Binaural</button>
                </div>
                <button class="close-noise-btn" onclick="toggleWhiteNoise()">
                    <i data-lucide="x"></i>
                </button>
            </div>
            
            <!-- Regular Sounds -->
            <div class="noise-content" id="regularContent">
                <div class="noise-options">
                    <button class="noise-btn" data-sound="storm" onclick="selectNoise('storm')">
                        <i data-lucide="cloud-lightning"></i>
                        <span>Storm</span>
                    </button>
                    <button class="noise-btn" data-sound="forest" onclick="selectNoise('forest')">
                        <i data-lucide="trees"></i>
                        <span>Forest</span>
                    </button>
                    <button class="noise-btn" data-sound="ocean" onclick="selectNoise('ocean')">
                        <i data-lucide="waves"></i>
                        <span>Ocean</span>
                    </button>
                    <button class="noise-btn" data-sound="coffee" onclick="selectNoise('coffee')">
                        <i data-lucide="coffee"></i>
                        <span>Caf√©</span>
                    </button>
                    <button class="noise-btn" data-sound="fire" onclick="selectNoise('fire')">
                        <i data-lucide="flame"></i>
                        <span>Fireplace</span>
                    </button>
                    <button class="noise-btn" data-sound="wind" onclick="selectNoise('wind')">
                        <i data-lucide="wind"></i>
                        <span>Wind</span>
                    </button>
                </div>
            </div>
            
            <!-- Binaural Beats -->
            <div class="noise-content hidden" id="binauralContent">
                <div class="noise-options">
                    <button class="noise-btn" data-sound="gamma40" onclick="selectNoise('gamma40')">
                        <i data-lucide="zap"></i>
                        <span>40Hz Gamma</span>
                    </button>
                    <button class="noise-btn" data-sound="beta20" onclick="selectNoise('beta20')">
                        <i data-lucide="brain"></i>
                        <span>20Hz Beta</span>
                    </button>
                    <button class="noise-btn" data-sound="alpha10" onclick="selectNoise('alpha10')">
                        <i data-lucide="circle-dot"></i>
                        <span>10Hz Alpha</span>
                    </button>
                    <button class="noise-btn" data-sound="theta6" onclick="selectNoise('theta6')">
                        <i data-lucide="moon"></i>
                        <span>6Hz Theta</span>
                    </button>
                    <button class="noise-btn" data-sound="delta3" onclick="selectNoise('delta3')">
                        <i data-lucide="bed"></i>
                        <span>3Hz Delta</span>
                    </button>
                    <button class="noise-btn" data-sound="focus15" onclick="selectNoise('focus15')">
                        <i data-lucide="target"></i>
                        <span>15Hz Focus</span>
                    </button>
                </div>
            </div>
            
            <div class="volume-control">
                <i data-lucide="volume-1"></i>
                <input type="range" id="noiseVolume" min="0" max="100" value="30" oninput="updateNoiseVolume(this.value)">
                <i data-lucide="volume-2"></i>
            </div>
        </div>

        <!-- Theme Selector with Live Preview -->
        <div class="theme-selector" id="themeSelector" style="display: none;">
            <div class="theme-header">
                <h3>Theme</h3>
                <button class="close-theme-btn" onclick="hideThemeSelector()">
                    <i data-lucide="x"></i>
                </button>
            </div>
            
            <!-- Added search input for themes -->
            <div class="theme-search-container">
                <i data-lucide="search"></i>
                <input 
                    type="text" 
                    id="themeSearchInput" 
                    class="theme-search-input"
                    placeholder="Theme..."
                    oninput="filterThemes(this.value)"
                >
            </div>

            <!-- Changed to vertical list layout with theme colors displayed as circles -->
            <div class="theme-list" id="themeList">
                <!-- Themes will be dynamically rendered here -->
            </div>
        </div>

        <!-- Added session mode selector modal -->
        <div class="modal-overlay" id="sessionModeOverlay" onclick="handleSessionModeConfirm(event)">
            <div class="modal" onclick="event.stopPropagation()">
                <div class="modal-header">
                    <div class="modal-title">Start Session</div>
                    <button class="close-btn" onclick="hideSessionMode()">
                        <i data-lucide="x"></i>
                    </button>
                </div>
                <div id="sessionModeContent">
                    <div class="session-mode-options">
                        <button class="session-mode-btn" onclick="startQuickSession()">
                            <i data-lucide="lightning"></i>
                            <span>Quick Session</span>
                            <small>No specific task</small>
                        </button>
                        <button class="session-mode-btn" onclick="showTaskSelector()">
                            <i data-lucide="check-square"></i>
                            <span>Task Session</span>
                            <small>Select a task</small>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Added task selector modal for session -->
        <div class="modal-overlay" id="taskSelectorOverlay" onclick="handleTaskSelectorConfirm(event)">
            <div class="modal" onclick="event.stopPropagation()">
                <div class="modal-header">
                    <div class="modal-title">Select Task</div>
                    <button class="close-btn" onclick="hideTaskSelector()">
                        <i data-lucide="x"></i>
                    </button>
                </div>
                <div id="taskSelectorContent">
                    <!-- Tasks will be listed here -->
                </div>
            </div>
        </div>

        <!-- Skip Confirmation Modal -->
        <div class="modal-overlay" id="skipModalOverlay" onclick="handleSkipConfirm(event)">
            <div class="modal" onclick="event.stopPropagation()">
                <div class="modal-header">
                    <div class="modal-title">Skip Session?</div>
                </div>
                <div id="skipModalContent">
                    <p>This session is too short to be counted in your statistics. You've completed <span id="sessionPercent">0</span>% of the session.</p>
                    <div class="modal-actions">
                        <button class="modal-btn cancel" onclick="cancelSkip()">Continue Session</button>
                        <button class="modal-btn danger" onclick="confirmSkip()">Skip Anyway</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Modal -->
        <div class="modal-overlay" id="modalOverlay" onclick="hideModal(event)">
            <div class="modal" onclick="event.stopPropagation()">
                <div class="modal-header">
                    <div class="modal-title" id="modalTitle">Statistics</div>
                    <button class="close-btn" onclick="hideModal()">
                        <i data-lucide="x"></i>
                    </button>
                </div>
                
                <div id="modalContent">
                    <!-- Content will be dynamically inserted here -->
                </div>
            </div>
        </div>

        <!-- Floating Timer Widget -->
        <div class="floating-widget" id="floatingWidget">
            <div class="floating-widget-header">
                <span id="floatingSessionLabel">Deep Focus</span>
                <button class="floating-close-btn" onclick="closeFloatingWidget()">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="floating-timer-display">
                <div id="floatingTimerTime">25:00</div>
            </div>
            <div class="floating-controls">
                <button class="floating-btn" onclick="toggleTimerFromWidget()">
                    <i data-lucide="play" id="floatingPlayIcon"></i>
                </button>
                <button class="floating-btn" onclick="skipSessionFromWidget()">
                    <i data-lucide="skip-forward"></i>
                </button>
            </div>
            <div class="floating-resize-handle"></div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        lucide.createIcons();
    </script>
</body>
</html>
